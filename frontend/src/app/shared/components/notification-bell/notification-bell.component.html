<div class="notification-bell-container">
  <!-- Bell Icon with Badge -->
  <button 
    class="bell-button" 
    (click)="toggleDropdown()"
    [class.has-unread]="hasUnread()"
    aria-label="Notifications">
    <svg class="bell-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
    </svg>
    
    @if (hasUnread()) {
      <span class="badge" [class.pulse]="hasUnread()">
        {{ unreadCount() > 99 ? '99+' : unreadCount() }}
      </span>
    }
  </button>

  <!-- Dropdown Menu -->
  @if (showDropdown()) {
    <div class="dropdown-overlay" (click)="closeDropdown()"></div>
    
    <div class="dropdown-menu">
      <!-- Header -->
      <div class="dropdown-header">
        <h3>Notifications</h3>
        @if (hasUnread()) {
          <button class="mark-all-btn" (click)="markAllAsRead($event)">
            Mark All Read
          </button>
        }
      </div>

      <!-- Loading State -->
      @if (loading()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Loading notifications...</p>
        </div>
      } @else if (recentNotifications().length > 0) {
        <!-- Notifications List -->
        <div class="notifications-list">
          @for (notification of recentNotifications(); track notification.id) {
            <div 
              class="notification-item"
              [class.unread]="!notification.isRead"
              [style.border-left-color]="getNotificationConfig(notification).color"
              (click)="onNotificationClick(notification)">
              
              <div class="notification-icon">
                {{ getNotificationConfig(notification).icon }}
              </div>
              
              <div class="notification-content">
                <h4 class="notification-title">{{ notification.title }}</h4>
                <p class="notification-message">{{ notification.message }}</p>
                <span class="notification-time">{{ getTimeAgo(notification.createdAt) }}</span>
              </div>

              @if (!notification.isRead) {
                <button 
                  class="mark-read-btn"
                  (click)="markAsRead(notification, $event)"
                  aria-label="Mark as read">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </button>
              }
            </div>
          }
        </div>
      } @else {
        <!-- Empty State -->
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <p>No notifications</p>
        </div>
      }

      <!-- Footer -->
      <div class="dropdown-footer">
        <a routerLink="/notifications" class="view-all-link" (click)="closeDropdown()">
          View All Notifications
        </a>
      </div>
    </div>
  }
</div>
