<div class="space-y-6">
  <!-- Header -->
  <div class="bg-white shadow rounded-lg p-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">External Verification</h1>
        <p class="mt-1 text-sm text-gray-500">Credit check and fraud detection</p>
      </div>
      <button
        (click)="viewApplicationDetails()"
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
      >
        Back to Application
      </button>
    </div>
  </div>

  @if (!verificationResult()) {
    <!-- Trigger Verification -->
    <div class="bg-white shadow rounded-lg p-6">
      <div class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">External Verification Not Started</h3>
        <p class="mt-1 text-sm text-gray-500">Trigger external verification to check credit score and fraud status.</p>
        <button
          (click)="triggerVerification()"
          [disabled]="isTriggering() || isCompleting()"
          class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          @if (isTriggering() || isCompleting()) {
            <span class="flex items-center space-x-2">
              <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
              <span>Processing...</span>
            </span>
          } @else {
            Trigger External Verification
          }
        </button>
      </div>
    </div>
  } @else {
    <ng-container *ngIf="verificationResult() as result">

    <!-- Verification Results -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Verification Results</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Credit Score -->
        <div class="bg-blue-50 rounded-lg p-4">
          <div class="text-sm text-gray-600">Credit Score</div>
          <div class="text-3xl font-bold text-blue-600 mt-2">
            {{ result.creditScore !== null ? result.creditScore : 'N/A' }}
          </div>
          @if (result.creditScoreReason) {
            <div class="text-xs text-gray-500 mt-2">{{ result.creditScoreReason }}</div>
          }
        </div>

        <!-- Risk Score -->
        <div class="bg-purple-50 rounded-lg p-4">
          <div class="text-sm text-gray-600">Risk Score</div>
          <div class="mt-2">
            <span [ngClass]="getRiskLevelBadgeClass(result.riskScore)"
                  class="px-4 py-2 text-lg font-semibold rounded-full">
              {{ result.riskScore }} ({{ result.riskScoreNumeric }})
            </span>
          </div>
        </div>

        <!-- Fraud Score -->
        <div class="bg-red-50 rounded-lg p-4">
          <div class="text-sm text-gray-600">Fraud Score</div>
          <div class="text-3xl font-bold text-red-600 mt-2">{{ result.fraudScore }}</div>
          @if (result.redAlertFlag) {
            <div class="text-xs text-red-600 font-semibold mt-2">⚠️ Red Alert Flagged</div>
          }
        </div>

        <!-- Data Found -->
        <div class="bg-green-50 rounded-lg p-4">
          <div class="text-sm text-gray-600">Data Found</div>
          <div class="mt-2">
            <span [ngClass]="result.dataFound ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                  class="px-4 py-2 text-sm font-semibold rounded-full">
              {{ result.dataFound ? 'Yes' : 'No' }}
            </span>
          </div>
        </div>
      </div>

      @if (result.riskFactors) {
        <div class="mt-6">
          <div class="text-sm font-medium text-gray-700 mb-2">Risk Factors</div>
          <div class="bg-gray-50 rounded-lg p-4">
            <p class="text-sm text-gray-900">{{ result.riskFactors }}</p>
          </div>
        </div>
      }

      <div class="mt-6">
        <div class="text-sm font-medium text-gray-700 mb-2">Recommended Action</div>
        <div class="bg-blue-50 rounded-lg p-4">
          <p class="text-sm font-medium text-gray-900">{{ result.recommendedAction }}</p>
        </div>
      </div>

      <div class="mt-6 flex justify-end">
        <button
          (click)="viewApplicationDetails()"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          Continue to Application Review
        </button>
      </div>
    </div>
    </ng-container>
  }
</div>
