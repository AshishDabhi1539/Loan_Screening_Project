<!-- Employment Details Form - COMPLETE & WORKING -->
<div class="min-h-screen bg-gray-50 py-8">
  <div class="container mx-auto px-4 max-w-4xl">
    
    <!-- Progress Stepper (Loan Officer style) -->
    <div class="bg-white shadow-lg rounded-xl p-6 mb-6">
      <div class="relative">
        <!-- Line background -->
        <div class="absolute top-6 left-0 right-0 h-1.5 bg-gray-200 rounded-full" style="z-index:0;"></div>
        <!-- Line active -->
        <div class="absolute top-6 left-0 h-1.5 bg-gradient-to-r from-green-500 via-green-400 to-primary-600 rounded-full transition-all duration-700 ease-in-out shadow-md" 
             [style.width.%]="getStepperLinePercentage()" style="z-index:1;"></div>

        <!-- Steps -->
        <div class="relative flex justify-between" style="z-index:2;">
          @for (step of getEmploymentSteps(); track step.label; let i = $index) {
            <div class="flex flex-col items-center" [style.flex]="'1'">
              <!-- Circle -->
              <div class="relative">
                <div [class]="getStepCircleClass(step.status) + ' w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-base transition-all duration-500 border-4 border-white relative z-10'">
                  @if (step.status === 'completed') {
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                  } @else if (step.status === 'current') {
                    <div class="w-2.5 h-2.5 bg-white rounded-full slow-pulse"></div>
                  } @else {
                    <span class="text-gray-600 opacity-70">{{ i + 1 }}</span>
                  }
                </div>
              </div>

              <!-- Label and status -->
              <div class="mt-3 text-center">
                <div [ngClass]="{
                      'text-primary-700 font-semibold': step.status === 'current',
                      'text-green-700 font-semibold': step.status === 'completed',
                      'text-gray-500': step.status === 'pending'
                    }" class="text-sm max-w-[140px]">{{ step.label }}</div>
                <div class="mt-2">
                  @if (step.status === 'completed') {
                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-50 text-green-700">
                      ‚úì Done
                    </span>
                  } @else if (step.status === 'current') {
                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary-50 text-primary-700">
                      ‚è∫ In Progress
                    </span>
                  } @else {
                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500">
                      Pending
                    </span>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-lg shadow p-6">
      <form [formGroup]="employmentForm" (ngSubmit)="onSubmit()">
        
        <!-- Step 1: Employment Type -->
        @if (currentStep() === 1) {
          <div class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">Select Employment Type</h2>
            
            <!-- Loan Type Info -->
            <!-- @if (loanType()) {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üìã Loan Type:</span> {{ loanType() }}
                  <br>
                  <span class="text-xs">Employment types are filtered based on your loan selection.</span>
                </p>
              </div>
            } -->
            
            <!-- Loading State -->
            @if (isLoadingEligibility()) {
              <div class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
                <p class="text-gray-600 mt-2">Loading eligibility information...</p>
              </div>
            }
            
            <!-- Employment Types Grid -->
            @if (!isLoadingEligibility()) {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for (type of employmentTypes(); track type.value) {
                  <button type="button" 
                    (click)="selectEmploymentType(type.value)"
                    [class.ring-2]="selectedEmploymentType() === type.value"
                    [class.ring-primary-500]="selectedEmploymentType() === type.value"
                    [class.bg-primary-50]="selectedEmploymentType() === type.value"
                    class="relative p-4 border rounded-lg text-left hover:bg-gray-50 transition-all hover:shadow-md">
                    
                    <div class="flex items-start gap-3">
                      <div class="text-3xl leading-none">{{ type.icon }}</div>
                      <div class="flex-1">
                        <div class="font-semibold mb-1">{{ type.label }}</div>
                        <div class="text-sm text-gray-600 mb-2">{{ type.description }}</div>
                        @if (type.minimumDurationMonths) {
                          <div class="text-xs text-primary-600 mt-2 font-medium">
                            ‚è± Min. {{ type.minimumDurationMonths }} months experience
                          </div>
                        }
                      </div>
                    </div>
                  </button>
                }
              </div>
            }
            
            <!-- Minimum Income Info -->
            @if (minimumIncome() > 0) {
              <div class="mt-3 flex justify-end">
                <div class="inline-block bg-yellow-100 border border-yellow-300 rounded-md px-3 py-1.5">
                  <p class="text-sm text-yellow-800">
                    <span class="font-semibold">üí∞ Minimum Income Required:</span> ‚Çπ{{ minimumIncome().toLocaleString('en-IN') }} per month
                  </p>
                </div>
              </div>
            }
          </div>
        }

        <!-- Step 2: Employment Details -->
        @if (currentStep() === 2) {
          <div class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">
              @if (selectedEmploymentType() === 'STUDENT') {
                Student Education Details
              } @else {
                Employment Details
              }
            </h2>
            
            @if (selectedEmploymentType() === 'SELF_EMPLOYED' || selectedEmploymentType() === 'BUSINESS_OWNER') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">‚ÑπÔ∏è Note:</span> Please fill the form fields with your business details. 
                  The labels are adapted based on your employment type. Additional specific fields (GST, Registration Numbers, etc.) 
                  will be requested during document upload.
                </p>
              </div>
            }
            
            <!-- Generic Employment Fields (ONLY for SALARIED, SELF_EMPLOYED, BUSINESS_OWNER, PROFESSIONAL) -->
            <!-- STUDENT, RETIRED, UNEMPLOYED, FREELANCER have their own specific sections below -->
            @if (needsCompanyDetails()) {
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">
                  @if (selectedEmploymentType() === 'SALARIED') {
                    Company Name *
                  } @else if (selectedEmploymentType() === 'SELF_EMPLOYED') {
                    Business/Practice Name *
                  } @else if (selectedEmploymentType() === 'BUSINESS_OWNER') {
                    Company/Business Name *
                  } @else {
                    Company Name *
                  }
                </label>
                <input type="text" formControlName="companyName" 
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  [placeholder]="selectedEmploymentType() === 'SALARIED' ? 'Enter company name' : 
                                 selectedEmploymentType() === 'SELF_EMPLOYED' ? 'Enter business/practice name' :
                                 selectedEmploymentType() === 'BUSINESS_OWNER' ? 'Enter company name' : 'Enter name'">
                @if (getFieldError('companyName')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('companyName') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">
                  @if (selectedEmploymentType() === 'SALARIED') {
                    Designation *
                  } @else if (selectedEmploymentType() === 'SELF_EMPLOYED') {
                    Nature of Business *
                  } @else if (selectedEmploymentType() === 'BUSINESS_OWNER') {
                    Business Type *
                  } @else {
                    Job Title *
                  }
                </label>
                <input type="text" formControlName="jobTitle"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  [placeholder]="selectedEmploymentType() === 'SALARIED' ? 'Your designation' : 
                                 selectedEmploymentType() === 'SELF_EMPLOYED' ? 'e.g., Consultancy, Medical Practice' :
                                 selectedEmploymentType() === 'BUSINESS_OWNER' ? 'e.g., Proprietorship, Partnership, Pvt Ltd' : 'Your title'">
                @if (getFieldError('jobTitle')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('jobTitle') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">
                  @if (selectedEmploymentType() === 'SALARIED') {
                    Employment Start Date *
                  } @else if (selectedEmploymentType() === 'SELF_EMPLOYED') {
                    Business Start Date *
                  } @else if (selectedEmploymentType() === 'BUSINESS_OWNER') {
                    Date of Incorporation *
                  } @else {
                    Start Date *
                  }
                </label>
                <input type="date" formControlName="employmentStartDate"
                  [max]="getCurrentDate()"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                @if (getFieldError('employmentStartDate')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('employmentStartDate') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">
                  @if (selectedEmploymentType() === 'SALARIED') {
                    Work Phone
                  } @else {
                    Business Phone
                  }
                </label>
                <input type="tel" formControlName="workPhone" maxlength="10"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  [placeholder]="selectedEmploymentType() === 'SALARIED' ? '10-digit work number' : '10-digit business number'">
                @if (getFieldError('workPhone')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('workPhone') }}</p>
                }
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">
                @if (selectedEmploymentType() === 'SALARIED') {
                  Office Address *
                } @else if (selectedEmploymentType() === 'SELF_EMPLOYED') {
                  Business Address *
                } @else if (selectedEmploymentType() === 'BUSINESS_OWNER') {
                  Registered Office Address *
                } @else {
                  Address *
                }
              </label>
              <input type="text" formControlName="companyAddress"
                class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                placeholder="Building, Street, Area">
              @if (getFieldError('companyAddress')) {
                <p class="text-red-600 text-xs mt-1">{{ getFieldError('companyAddress') }}</p>
              }
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">City *</label>
                <input type="text" formControlName="companyCity"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                @if (getFieldError('companyCity')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('companyCity') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">State *</label>
                <select formControlName="companyState"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                  <option value="">Select State</option>
                  @for (state of states; track state) {
                    <option [value]="state">{{ state }}</option>
                  }
                </select>
                @if (getFieldError('companyState')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('companyState') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">PIN Code *</label>
                <input type="text" formControlName="companyPincode" maxlength="6"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="6-digit PIN">
                @if (getFieldError('companyPincode')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('companyPincode') }}</p>
                }
              </div>
            </div>
            }
            
            <!-- PROFESSIONAL Specific Fields -->
            @if (selectedEmploymentType() === 'PROFESSIONAL') {
              <div class="border-t pt-4 mt-4">
                <h3 class="text-md font-semibold mb-3 text-primary-600">Professional Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Profession Type *</label>
                    <select formControlName="professionType" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Profession</option>
                      <option value="DOCTOR">Doctor</option>
                      <option value="LAWYER">Lawyer</option>
                      <option value="CHARTERED_ACCOUNTANT">Chartered Accountant (CA)</option>
                      <option value="ARCHITECT">Architect</option>
                      <option value="ENGINEER">Engineer</option>
                      <option value="CONSULTANT">Consultant</option>
                      <option value="OTHER">Other</option>
                    </select>
                    @if (getFieldError('professionType')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('professionType') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Registration/License Number *</label>
                    <input type="text" formControlName="registrationNumber" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Medical Council Registration">
                    @if (getFieldError('registrationNumber')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('registrationNumber') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Registration Authority *</label>
                    <input type="text" formControlName="registrationAuthority" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Medical Council of India">
                    @if (getFieldError('registrationAuthority')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('registrationAuthority') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Professional Qualification *</label>
                    <input type="text" formControlName="professionalQualification" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., MBBS, LLB, CA">
                    @if (getFieldError('professionalQualification')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('professionalQualification') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">University/Institute</label>
                    <input type="text" formControlName="university" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Year of Qualification</label>
                    <input type="number" formControlName="yearOfQualification" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="YYYY" min="1970" [max]="getCurrentYear()">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Practice Area/Specialization</label>
                    <input type="text" formControlName="practiceArea" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Cardiology, Corporate Law">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Clinic/Firm Name</label>
                    <input type="text" formControlName="clinicOrFirmName" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Practice/Clinic/Firm name">
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Clinic/Firm Address</label>
                    <input type="text" formControlName="clinicOrFirmAddress" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Practice address">
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Additional Certifications</label>
                    <textarea formControlName="additionalCertifications" rows="2" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Any additional qualifications or certifications"></textarea>
                  </div>
                </div>
              </div>
            }
            
            <!-- FREELANCER Specific Fields -->
            @if (selectedEmploymentType() === 'FREELANCER') {
              <div class="border-t pt-4 mt-4">
                <h3 class="text-md font-semibold mb-3 text-primary-600">Freelance Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Type of Freelance Work *</label>
                    <input type="text" formControlName="freelanceType" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Web Development, Content Writing">
                    @if (getFieldError('freelanceType')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('freelanceType') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Freelancing Since *</label>
                    <input type="date" formControlName="freelanceSince" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" [max]="getCurrentDate()">
                    @if (getFieldError('freelanceSince')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('freelanceSince') }}</p>
                    }
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Primary Clients (List top 3) *</label>
                    <textarea formControlName="primaryClients" rows="3" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Client 1, Client 2, Client 3"></textarea>
                    @if (getFieldError('primaryClients')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('primaryClients') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Average Monthly Income</label>
                    <div class="relative">
                      <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                      <input type="number" formControlName="averageMonthlyIncome" class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Last 6 months average">
                    </div>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Portfolio/Website URL</label>
                    <input type="url" formControlName="portfolioUrl" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="https://...">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Freelance Platform</label>
                    <input type="text" formControlName="freelancePlatform" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Upwork, Fiverr, Freelancer.com">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Active Clients Count</label>
                    <input type="number" formControlName="activeClientsCount" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Number of active clients" min="0">
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Skill Set</label>
                    <textarea formControlName="skillSet" rows="2" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Key professional skills (comma-separated)"></textarea>
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Project Types</label>
                    <textarea formControlName="projectTypes" rows="2" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Types of projects you handle"></textarea>
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Payment Methods</label>
                    <input type="text" formControlName="paymentMethods" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="How clients pay you (bank transfer, PayPal, etc.)">
                  </div>
                </div>
              </div>
            }
            
            <!-- RETIRED Specific Fields -->
            @if (selectedEmploymentType() === 'RETIRED') {
              <div class="border-t pt-4 mt-4">
                <h3 class="text-md font-semibold mb-3 text-primary-600">Retirement Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Pension Type *</label>
                    <select formControlName="pensionType" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Type</option>
                      <option value="GOVERNMENT">Government</option>
                      <option value="PRIVATE">Private</option>
                      <option value="PPF">PPF</option>
                      <option value="MILITARY">Military</option>
                      <option value="OTHER">Other</option>
                    </select>
                    @if (getFieldError('pensionType')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('pensionType') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Pension Provider *</label>
                    <input type="text" formControlName="pensionProvider" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Organization providing pension">
                    @if (getFieldError('pensionProvider')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('pensionProvider') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">PPO Number</label>
                    <input type="text" formControlName="ppoNumber" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Pension Payment Order number">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Monthly Pension Amount *</label>
                    <div class="relative">
                      <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                      <input type="number" formControlName="monthlyPensionAmount" class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                    </div>
                    @if (getFieldError('monthlyPensionAmount')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('monthlyPensionAmount') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Retirement Date *</label>
                    <input type="date" formControlName="retirementDate" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" [max]="getCurrentDate()">
                    @if (getFieldError('retirementDate')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('retirementDate') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Previous Employer *</label>
                    <input type="text" formControlName="previousEmployer" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Last employer before retirement">
                    @if (getFieldError('previousEmployer')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('previousEmployer') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Previous Designation *</label>
                    <input type="text" formControlName="previousDesignation" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Last job title">
                    @if (getFieldError('previousDesignation')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('previousDesignation') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Years of Service</label>
                    <input type="number" formControlName="yearsOfService" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Total years worked" min="0">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Pension Account Number</label>
                    <input type="text" formControlName="pensionAccountNumber" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Bank account for pension">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Pension Bank Name</label>
                    <input type="text" formControlName="pensionBankName" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Bank where pension is credited">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Gratuity Amount</label>
                    <div class="relative">
                      <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                      <input type="number" formControlName="gratuityAmount" class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="One-time gratuity received">
                    </div>
                  </div>
                  
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">Additional Retirement Benefits</label>
                    <textarea formControlName="additionalRetirementBenefits" rows="2" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Medical benefits, other allowances, etc."></textarea>
                  </div>
                </div>
              </div>
            }
            
            <!-- STUDENT Specific Fields -->
            @if (selectedEmploymentType() === 'STUDENT') {
              <div class="border-t pt-4 mt-4">
                <h3 class="text-md font-semibold mb-3 text-primary-600">Education Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Institution Name *</label>
                    <input type="text" formControlName="institutionName" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="University/College name">
                    @if (getFieldError('institutionName')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('institutionName') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Course Name *</label>
                    <input type="text" formControlName="courseName" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., B.Tech, MBA, MBBS">
                    @if (getFieldError('courseName')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('courseName') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Specialization</label>
                    <input type="text" formControlName="specialization" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Computer Science, Finance">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Year of Study *</label>
                    <select formControlName="yearOfStudy" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Year</option>
                      <option value="1">1st Year</option>
                      <option value="2">2nd Year</option>
                      <option value="3">3rd Year</option>
                      <option value="4">4th Year</option>
                      <option value="5">5th Year</option>
                    </select>
                    @if (getFieldError('yearOfStudy')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('yearOfStudy') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Total Course Duration *</label>
                    <select formControlName="totalCourseDuration" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Duration</option>
                      <option value="1">1 Year</option>
                      <option value="2">2 Years</option>
                      <option value="3">3 Years</option>
                      <option value="4">4 Years</option>
                      <option value="5">5 Years</option>
                      <option value="6">6 Years</option>
                    </select>
                    @if (getFieldError('totalCourseDuration')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('totalCourseDuration') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Expected Graduation Year *</label>
                    <input type="number" formControlName="expectedGraduationYear" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="YYYY" min="2024" max="2035">
                    @if (getFieldError('expectedGraduationYear')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('expectedGraduationYear') }}</p>
                    }
                  </div>
                </div>
                
                <!-- Guardian/Co-Applicant Details -->
                <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                  <p class="text-sm font-semibold text-yellow-800 mb-2">
                    ‚ö†Ô∏è Co-Applicant Required for Education Loan
                  </p>
                  <p class="text-xs text-yellow-700">Guardian/Parent details are mandatory for student loan applications.</p>
                </div>
                
                <h4 class="text-md font-semibold mt-4 mb-3 text-gray-700">Guardian/Co-Applicant Details</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Name *</label>
                    <input type="text" formControlName="guardianName" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Full name">
                    @if (getFieldError('guardianName')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianName') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Relationship *</label>
                    <select formControlName="guardianRelation" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Relationship</option>
                      <option value="FATHER">Father</option>
                      <option value="MOTHER">Mother</option>
                      <option value="LEGAL_GUARDIAN">Legal Guardian</option>
                      <option value="SPOUSE">Spouse</option>
                    </select>
                    @if (getFieldError('guardianRelation')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianRelation') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Occupation *</label>
                    <input type="text" formControlName="guardianOccupation" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Job/Business">
                    @if (getFieldError('guardianOccupation')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianOccupation') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Employer *</label>
                    <input type="text" formControlName="guardianEmployer" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Company/Business name">
                    @if (getFieldError('guardianEmployer')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianEmployer') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Monthly Income *</label>
                    <div class="relative">
                      <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                      <input type="number" formControlName="guardianMonthlyIncome" class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="Min ‚Çπ30,000">
                    </div>
                    @if (getFieldError('guardianMonthlyIncome')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianMonthlyIncome') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Contact *</label>
                    <input type="tel" formControlName="guardianContact" maxlength="10" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="10-digit mobile">
                    @if (getFieldError('guardianContact')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('guardianContact') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian Email</label>
                    <input type="email" formControlName="guardianEmail" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="email@example.com">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Guardian PAN Number</label>
                    <input type="text" formControlName="guardianPanNumber" maxlength="10" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="ABCDE1234F">
                  </div>
                </div>
              </div>
            }
            
            <!-- UNEMPLOYED Specific Fields -->
            @if (selectedEmploymentType() === 'UNEMPLOYED') {
              <div class="border-t pt-4 mt-4">
                <div class="bg-orange-50 border-l-4 border-orange-400 p-4 mb-4">
                  <p class="text-sm font-semibold text-orange-800 mb-1">
                    ‚ö†Ô∏è Limited Loan Eligibility
                  </p>
                  <p class="text-xs text-orange-700">Unemployed status limits loan options. Only Gold Loan and Loan Against Property (with collateral) are typically available.</p>
                </div>
                
                <h3 class="text-md font-semibold mb-3 text-primary-600">Current Status</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Reason for Unemployment *</label>
                    <select formControlName="unemploymentReason" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                      <option value="">Select Reason</option>
                      <option value="LOOKING_FOR_WORK">Actively looking for work</option>
                      <option value="BETWEEN_JOBS">Between jobs</option>
                      <option value="HEALTH_REASONS">Health reasons</option>
                      <option value="CARING_RESPONSIBILITIES">Caring for family</option>
                      <option value="OTHER">Other</option>
                    </select>
                    @if (getFieldError('unemploymentReason')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('unemploymentReason') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Last Employment Date</label>
                    <input type="date" formControlName="lastEmploymentDate" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" [max]="getCurrentDate()">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Current Income Source *</label>
                    <input type="text" formControlName="currentIncomeSource" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Family support, Savings, Investments">
                    @if (getFieldError('currentIncomeSource')) {
                      <p class="text-red-600 text-xs mt-1">{{ getFieldError('currentIncomeSource') }}</p>
                    }
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Assets Owned (if any)</label>
                    <input type="text" formControlName="assetsOwned" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500" placeholder="e.g., Property, Gold, Investments">
                  </div>
                </div>
              </div>
            }
          </div>
        }

        <!-- Step 3: Income Details -->
        @if (currentStep() === 3) {
          <div class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">Income Details</h2>
            
            <!-- Employment-Type-Specific Message -->
            @if (selectedEmploymentType() === 'STUDENT') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üë®‚Äçüéì Student Loan:</span> Since you're a student, we'll use your guardian's income (provided in Step 2) for loan eligibility assessment.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'RETIRED') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üèñÔ∏è Retired Applicant:</span> Your monthly pension amount (provided in Step 2) will be used as your regular income.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'FREELANCER') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üíª Freelancer:</span> Your average monthly income (provided in Step 2) will be used for loan assessment.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'UNEMPLOYED') {
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="text-sm text-yellow-700">
                  <span class="font-semibold">‚ö†Ô∏è Unemployed Applicant:</span> Please provide any income from family support, savings, investments, or other sources. Minimal income may affect loan eligibility.
                </p>
              </div>
            }
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Income Type *</label>
                <select formControlName="incomeType"
                  [class]="'w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500 ' + (isIncomeTypeReadonly() || isIncomeAutoPopulated() ? 'bg-gray-100 cursor-not-allowed' : '')"
                  [attr.readonly]="isIncomeTypeReadonly() || isIncomeAutoPopulated() ? true : null"
                  (mousedown)="(isIncomeTypeReadonly() || isIncomeAutoPopulated()) ? $event.preventDefault() : null">
                  <option value="">Select Type</option>
                  @for (type of incomeTypes; track type.value) {
                    <option [value]="type.value">{{ type.label }}</option>
                  }
                </select>
                @if (getFieldError('incomeType')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('incomeType') }}</p>
                }
                @if (isIncomeTypeReadonly() || isIncomeAutoPopulated()) {
                  <p class="text-xs text-blue-600 mt-1">‚ÑπÔ∏è Auto-selected based on your employment type</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">{{ getIncomeSourceLabel() }} *</label>
                <div class="relative">
                  <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                  <input type="number" formControlName="monthlyIncome"
                    [class]="'w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500 ' + (isIncomeAutoPopulated() ? 'bg-gray-100 cursor-not-allowed' : '')"
                    [attr.readonly]="isIncomeAutoPopulated() ? true : null"
                    placeholder="50000">
                </div>
                @if (getFieldError('monthlyIncome')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('monthlyIncome') }}</p>
                }
                <p class="text-xs text-gray-500 mt-1">{{ getIncomeHelpText() }}</p>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Additional Income (Optional)</label>
              <div class="relative">
                <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                <input type="number" formControlName="additionalIncome"
                  class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="0">
              </div>
            </div>

            @if (getTotalIncome() > 0) {
              <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                  <span class="font-medium">Total Monthly Income:</span>
                  <span class="text-xl font-bold text-green-600">{{ formatCurrency(getTotalIncome()) }}</span>
                </div>
              </div>
            }
            
            <!-- FOIR Calculator -->
            @if (employmentForm.get('monthlyIncome')?.value > 0) {
              <div class="mt-6">
                <app-foir-calculator
                  [monthlyIncome]="getTotalIncome()"
                  [existingObligations]="employmentForm.get('existingLoanEmi')?.value || 0"
                  [newEmi]="calculateEstimatedEMI()">
                </app-foir-calculator>
              </div>
            }
          </div>
        }

        <!-- Step 4: Banking Details -->
        @if (currentStep() === 4) {
          <div class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">Banking Details</h2>
            
            <!-- Employment-Type-Specific Banking Message -->
            @if (selectedEmploymentType() === 'STUDENT') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üè¶ Student Account:</span> Provide the bank account where loan disbursement should be made. This can be your account or your guardian's account.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'UNEMPLOYED') {
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="text-sm text-yellow-700">
                  <span class="font-semibold">üè¶ Banking Details:</span> Provide your savings account details. A co-applicant may be required for loan approval.
                </p>
              </div>
            }
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Bank Name *</label>
                <input type="text" formControlName="bankName"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="e.g., HDFC Bank">
                @if (getFieldError('bankName')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('bankName') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">Account Type *</label>
                <select formControlName="accountType"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500">
                  <option value="">Select Type</option>
                  @for (type of accountTypes; track type.value) {
                    <option [value]="type.value">{{ type.label }}</option>
                  }
                </select>
                @if (getFieldError('accountType')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('accountType') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">Account Number *</label>
                <input type="text" formControlName="accountNumber"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="Account number">
                @if (getFieldError('accountNumber')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('accountNumber') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">IFSC Code *</label>
                <input type="text" formControlName="ifscCode" maxlength="11"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="HDFC0001234" style="text-transform: uppercase;">
                @if (getFieldError('ifscCode')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('ifscCode') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">Branch Name *</label>
                <input type="text" formControlName="branchName"
                  class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                  placeholder="Branch name">
                @if (getFieldError('branchName')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('branchName') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">Avg. Balance *</label>
                <div class="relative">
                  <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                  <input type="number" formControlName="bankAccountBalance"
                    class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                    placeholder="50000">
                </div>
                @if (getFieldError('bankAccountBalance')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('bankAccountBalance') }}</p>
                }
              </div>
            </div>
          </div>
        }

        <!-- Step 5: Financial Obligations -->
        @if (currentStep() === 5) {
          <div class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">Financial Obligations</h2>
            
            <!-- Employment-Type-Specific Financial Obligations Message -->
            @if (selectedEmploymentType() === 'STUDENT') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üí∞ Student Expenses:</span> Enter your typical monthly expenses. Existing loans/credit cards can be left at ‚Çπ0 if none. Your guardian's obligations are already considered.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'RETIRED') {
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">üí∞ Retired Applicant:</span> Include your regular monthly expenses and any existing loan EMIs or credit card dues. This helps assess your disposable income.
                </p>
              </div>
            }
            
            @if (selectedEmploymentType() === 'UNEMPLOYED') {
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="text-sm text-yellow-700">
                  <span class="font-semibold">‚ö†Ô∏è Financial Obligations:</span> Provide accurate monthly expenses. Existing loans will impact eligibility. Consider adding a co-applicant to strengthen your application.
                </p>
              </div>
            }
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Monthly Expenses *</label>
                <div class="relative">
                  <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                  <input type="number" formControlName="monthlyExpenses"
                    class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                    placeholder="20000">
                </div>
                @if (getFieldError('monthlyExpenses')) {
                  <p class="text-red-600 text-xs mt-1">{{ getFieldError('monthlyExpenses') }}</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium mb-1">Existing Loan EMI</label>
                <div class="relative">
                  <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                  <input type="number" formControlName="existingLoanEmi"
                    class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                    placeholder="0">
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-1">Credit Card Outstanding</label>
                <div class="relative">
                  <span class="absolute left-3 top-2.5 text-gray-500">‚Çπ</span>
                  <input type="number" formControlName="creditCardOutstanding"
                    class="w-full pl-8 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500"
                    placeholder="0">
                </div>
              </div>
            </div>

            <!-- Financial Summary -->
            @if (getTotalIncome() > 0) {
              <div class="mt-6 bg-white border-2 border-gray-200 rounded-xl shadow-sm overflow-hidden">
                <!-- Header -->
                <div class="bg-gradient-to-r from-primary-600 to-primary-700 px-5 py-3">
                  <h3 class="text-lg font-bold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Financial Summary
                  </h3>
                </div>

                <!-- Summary Cards -->
                <div class="p-5">
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-5">
                    <!-- Total Income Card -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Total Income</span>
                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      </div>
                      <div class="text-2xl font-bold text-gray-900">{{ formatCurrency(getTotalIncome()) }}</div>
                      <div class="text-xs text-gray-500 mt-1">Monthly</div>
                    </div>

                    <!-- Total Obligations Card -->
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Total Obligations</span>
                        <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </div>
                      <div class="text-2xl font-bold text-gray-900">{{ formatCurrency(getTotalObligations()) }}</div>
                      <div class="text-xs text-gray-500 mt-1">Monthly</div>
                    </div>

                    <!-- Disposable Income Card -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Disposable Income</span>
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                      </div>
                      <div class="text-2xl font-bold text-green-700">{{ formatCurrency(getDisposableIncome()) }}</div>
                      <div class="text-xs text-gray-500 mt-1">Available Monthly</div>
                    </div>

                    <!-- FOIR Card -->
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600 uppercase tracking-wide">FOIR</span>
                        <svg class="w-4 h-4" [class.text-green-600]="getFOIR() < 50" 
                             [class.text-yellow-600]="getFOIR() >= 50 && getFOIR() < 70"
                             [class.text-red-600]="getFOIR() >= 70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                      </div>
                      <div class="text-2xl font-bold" 
                           [class.text-green-700]="getFOIR() < 50" 
                           [class.text-yellow-700]="getFOIR() >= 50 && getFOIR() < 70"
                           [class.text-red-700]="getFOIR() >= 70">
                        {{ getFOIR() }}%
                      </div>
                      <div class="text-xs font-medium mt-1" 
                           [class.text-green-700]="getFOIR() < 50" 
                           [class.text-yellow-700]="getFOIR() >= 50 && getFOIR() < 70"
                           [class.text-red-700]="getFOIR() >= 70">
                        @if (getFOIR() < 50) {
                          Excellent
                        } @else if (getFOIR() < 70) {
                          Acceptable
                        } @else {
                          High Risk
                        }
                      </div>
                    </div>
                  </div>

                  <!-- FOIR Status Alert -->
                  <div class="rounded-lg p-4 border-2" 
                       [class.bg-green-50]="getFOIR() < 50"
                       [class.border-green-300]="getFOIR() < 50"
                       [class.bg-yellow-50]="getFOIR() >= 50 && getFOIR() < 70"
                       [class.border-yellow-300]="getFOIR() >= 50 && getFOIR() < 70"
                       [class.bg-red-50]="getFOIR() >= 70"
                       [class.border-red-300]="getFOIR() >= 70">
                    <div class="flex items-start">
                      @if (getFOIR() >= 70) {
                        <svg class="w-5 h-5 text-red-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                      } @else if (getFOIR() >= 50) {
                        <svg class="w-5 h-5 text-yellow-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                      } @else {
                        <svg class="w-5 h-5 text-green-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                      }
                      <div class="flex-1">
                        <p class="text-sm font-semibold mb-1"
                           [class.text-red-800]="getFOIR() >= 70"
                           [class.text-yellow-800]="getFOIR() >= 50 && getFOIR() < 70"
                           [class.text-green-800]="getFOIR() < 50">
                          @if (getFOIR() >= 70) {
                            High FOIR Detected
                          } @else if (getFOIR() >= 50) {
                            Moderate FOIR Level
                          } @else {
                            Excellent Financial Health
                          }
                        </p>
                        <p class="text-xs"
                           [class.text-red-700]="getFOIR() >= 70"
                           [class.text-yellow-700]="getFOIR() >= 50 && getFOIR() < 70"
                           [class.text-green-700]="getFOIR() < 50">
                          @if (getFOIR() >= 70) {
                            Your FOIR is above 70%. Loan approval may be affected. Consider reducing existing obligations or increasing your income.
                          } @else if (getFOIR() >= 50) {
                            Your FOIR is between 50-70%. This is acceptable but consider reducing obligations to improve your loan eligibility.
                          } @else {
                            Your FOIR is below 50%. You have a healthy financial profile with good repayment capacity.
                          }
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }

        <!-- Form Actions -->
        <div class="flex justify-between items-center mt-6 pt-6 border-t">
          <button type="button" (click)="cancel()"
            class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">
            Cancel
          </button>

          <div class="space-x-2">
            @if (currentStep() > 1) {
              <button type="button" (click)="previousStep()"
                class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">
                Previous
              </button>
            }

            @if (currentStep() < totalSteps) {
              <button type="button" (click)="nextStep()" [disabled]="!isStepValid(currentStep())"
                class="px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
              </button>
            } @else {
              <button type="submit" [disabled]="!employmentForm.valid || isLoading()"
                class="px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
                @if (isLoading()) {
                  <span>Saving...</span>
                } @else {
                  <span>Submit & Continue</span>
                }
              </button>
            }
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
